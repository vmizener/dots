###########
# Init work

# Break early on non-interactive shell
[ -z "$PS1" ] && return

# Set umask to give group write permissions
# (Default is 022)
umask 002

# Color variables for convenience
# To print all zshrc colors:
# for i in {1..256}; do print -P "%F{$i}Color : $i"; done;
local c_blk='%F{0}'     # Soft Black
local c_red='%F{1}'     # Soft Red
local c_grn='%F{2}'     # Soft Green
local c_ylw='%F{3}'     # Soft Yellow
local c_blu='%F{4}'     # Soft Blue
local c_mag='%F{5}'     # Soft Magenta
local c_cyn='%F{6}'     # Soft Cyan
local c_wht='%F{7}'     # Soft White
local C_blk='%F{8}'     # Emph Black
local C_red='%F{9}'     # Emph Red
local C_grn='%F{10}'    # Emph Green
local C_ylw='%F{11}'    # Emph Yellow
local C_blu='%F{12}'    # Emph Blue
local C_mag='%F{13}'    # Emph Magenta
local C_cyn='%F{14}'    # Emph Cyan
local C_wht='%F{15}'    # Emph White
local c_reset='%f'      # Reset color

# Build path
PATH=.
PATH=$PATH:/usr/local/sbin
PATH=$PATH:/usr/local/bin
PATH=$PATH:/usr/sbin
PATH=$PATH:/usr/bin
PATH=$PATH:/sbin
PATH=$PATH:/bin

if [ ! -z $VIRTUAL_ENV ]; then
    PATH=${VIRTUAL_ENV}/bin:$PATH
fi
for d (
    /opt/X11/bin
    /Library/TeX/texbin
    ${HOME}/.pyenv/bin
) do;
    [ -d $d ] && PATH=$PATH:$d
done

export PATH


# Enable history
export HISTSIZE=10000
export SAVEHIST=10000
export HISTFILE=${HOME}/.zsh_history


###########
# Startup
ZSHCONFIGFILES=(${HOME}/.config/zsh/**/*.zsh)

# Load path files
for file in ${(M)ZSHCONFIGFILES:#*/path.zsh}; do
    source ${file}
done

# Load non-path/non-completion files
for file in ${${ZSHCONFIGFILES:#*/path.zsh}:#*/completion.zsh}; do
    source ${file}
done

# Enable autocomplete
zmodload zsh/complist
bindkey -M menuselect '^[[Z' reverse-menu-complete  # Support shift-tab
autoload -U compinit && compinit

# Load completion files
for file in ${(M)ZSHCONFIGFILES:#*/completion.zsh}; do
    source ${file}
done

unset ZSHCONFIGFILES

# Load local init
if [[ -e ${HOME}/.localrc ]]; then
    source ${HOME}/.localrc
fi

# TODO: syntax highlighting: https://github.com/zsh-users/zsh-syntax-highlighting
# TODO: tab-completion not from initial character
